require.config({
    config: {
        'jsbuild':{"magnifier/magnify.js":"/**\r\n * Copyright \u00c2\u00a9 Magento, Inc. All rights reserved.\r\n * See COPYING.txt for license details.\r\n */\r\ndefine([\r\n    'jquery',\r\n    'underscore',\r\n    'magnifier/magnifier'\r\n], function ($, _) {\r\n    'use strict';\r\n\r\n    return function (config, element) {\r\n\r\n        var isTouchEnabled = 'ontouchstart' in document.documentElement,\r\n            gallerySelector = '[data-gallery-role=\"gallery\"]',\r\n            magnifierSelector = '[data-gallery-role=\"magnifier\"]',\r\n            magnifierZoomSelector = '[data-gallery-role=\"magnifier-zoom\"]',\r\n            zoomInButtonSelector = '[data-gallery-role=\"fotorama__zoom-in\"]',\r\n            zoomOutButtonSelector = '[data-gallery-role=\"fotorama__zoom-out\"]',\r\n            fullscreenImageSelector = '[data-gallery-role=\"stage-shaft\"] [data-active=\"true\"] .fotorama__img--full',\r\n            imageDraggableClass = 'fotorama__img--draggable',\r\n            imageZoommable = 'fotorama__img--zoommable',\r\n            zoomInLoaded = 'zoom-in-loaded',\r\n            zoomOutLoaded = 'zoom-out-loaded',\r\n            zoomInDisabled = 'fotorama__zoom-in--disabled',\r\n            zoomOutDisabled = 'fotorama__zoom-out--disabled',\r\n            keyboardNavigation,\r\n            videoContainerClass = 'fotorama-video-container',\r\n            hideMagnifier,\r\n            dragFlag,\r\n            endX,\r\n            transitionEnabled,\r\n            transitionActive = false,\r\n            tapFlag = 0,\r\n            allowZoomOut = false,\r\n            allowZoomIn = true;\r\n\r\n        if (isTouchEnabled) {\r\n            $(element).on('fotorama:showend fotorama:load', function () {\r\n                $(magnifierSelector).remove();\r\n                $(magnifierZoomSelector).remove();\r\n            });\r\n        }\r\n\r\n        (function () {\r\n            var style = document.documentElement.style,\r\n                transitionEnabled = style.transition !== undefined ||\r\n                style.WebkitTransition !== undefined ||\r\n                style.MozTransition !== undefined ||\r\n                style.MsTransition !== undefined ||\r\n                style.OTransition !== undefined;\r\n        })();\r\n\r\n        /**\r\n         * Return width and height of original image\r\n         * @param src path for original image\r\n         * @returns {{rw: number, rh: number}}\r\n         */\r\n        function getImageSize(src) {\r\n            var img = new Image(),\r\n                imgSize = {\r\n                    rw: 0,\r\n                    rh: 0\r\n                };\r\n\r\n            img.src = src;\r\n            imgSize.rw = img.width;\r\n            imgSize.rh = img.height;\r\n\r\n            return imgSize;\r\n        }\r\n\r\n        /**\r\n         * Sets min-height and min-width for image to avoid transition bug\r\n         * @param $image - fullscreen image\r\n         */\r\n        function calculateMinSize($image) {\r\n\r\n            var minHeight,\r\n                minWidth,\r\n                height = $image.height(),\r\n                width = $image.width(),\r\n                parentHeight = $image.parent().height(),\r\n                parentWidth = $image.parent().width();\r\n\r\n            if (width > parentWidth || height > parentHeight) {\r\n\r\n                if (width / height < parentWidth / parentHeight) {\r\n                    minHeight = parentHeight;\r\n                    minWidth = width * (parentHeight / height);\r\n                } else {\r\n                    minWidth = parentWidth;\r\n                    minHeight = height * parentWidth / width;\r\n                }\r\n                $image.css({\r\n                    'min-width': minWidth,\r\n                    'min-height': minHeight\r\n                });\r\n            }\r\n        }\r\n\r\n        function toggleZoomable($image, flag) {\r\n            if (flag) {\r\n                $image.css({\r\n                    'min-width': $image.width(),\r\n                    'min-height': $image.height(),\r\n                    'width': $image.width(),\r\n                    'height': $image.height()\r\n                }).addClass(imageZoommable);\r\n            } else {\r\n                $image.css({\r\n                    width: '',\r\n                    height: '',\r\n                    top: '',\r\n                    left: '',\r\n                    right: '',\r\n                    bottom: ''\r\n                }).removeClass(imageZoommable);\r\n                calculateMinSize($image);\r\n            }\r\n        }\r\n\r\n        function resetVars($image) {\r\n            allowZoomIn = true;\r\n            allowZoomOut = dragFlag = transitionActive = false;\r\n            $image.hasClass(imageDraggableClass) && $image.removeClass(imageDraggableClass);\r\n            toggleZoomable($image, false);\r\n        }\r\n\r\n        /**\r\n         * Set state for zoom controls.\r\n         * If state is true, zoom controls will be visible.\r\n         * IF state is false, zoom controls will be hidden.\r\n         * @param isHide\r\n         */\r\n        function hideZoomControls(isHide) {\r\n            if (isHide) {\r\n                $(zoomInButtonSelector).addClass(zoomInDisabled);\r\n                $(zoomOutButtonSelector).addClass(zoomOutDisabled);\r\n            } else {\r\n                $(zoomInButtonSelector).removeClass(zoomInDisabled);\r\n                $(zoomOutButtonSelector).removeClass(zoomOutDisabled);\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Asynchronus control visibility of zoom buttons.\r\n         * If image bigger than her wrapper. Zoom controls must visible.\r\n         * @param path - image source path\r\n         * @param $image\r\n         */\r\n        function asyncToggleZoomButtons(path, $image) {\r\n            var img = new Image();\r\n            img.onload = function () {\r\n                this.height > $image.parent().height() || this.width > $image.parent().width() ?\r\n                    hideZoomControls(false) : hideZoomControls(true);\r\n            };\r\n            img.src = path;\r\n        }\r\n\r\n        /**\r\n         * Control visibility of zoom buttons.\r\n         * Zoom controls must be invisible for video content and touch devices.\r\n         * On touch devices active pinchIn/pinchOut.\r\n         * @param $image\r\n         * @param isTouchScreen - true for touch devices\r\n         * @param isVideoActiveFrame - true for active video frame\r\n         */\r\n        function toggleZoomButtons($image, isTouchScreen, isVideoActiveFrame) {\r\n            var path = $image.attr('src');\r\n\r\n            if (path && !isTouchScreen && !isVideoActiveFrame) {\r\n                asyncToggleZoomButtons(path, $image);\r\n            } else {\r\n                hideZoomControls(true);\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Handle resize event in fullscreen.\r\n         * @param $image - Fullscreen image.\r\n         * @param e - Event.\r\n         */\r\n        function resizeHandler(e, $image) {\r\n            var imageSize,\r\n                parentWidth,\r\n                parentHeight,\r\n                isImageSmall,\r\n                isImageFit;\r\n\r\n            if (!e.data.$image || !e.data.$image.length)\r\n                return;\r\n\r\n            imageSize = getImageSize($(fullscreenImageSelector)[0].src);\r\n            parentWidth = e.data.$image.parent().width();\r\n            parentHeight = e.data.$image.parent().height();\r\n            isImageSmall = parentWidth >= imageSize.rw && parentHeight >= imageSize.rh;\r\n            isImageFit = parentWidth > e.data.$image.width() && parentHeight > e.data.$image.height();\r\n\r\n            toggleZoomButtons(e.data.$image, isTouchEnabled, checkForVideo(e.data.fotorama.activeFrame.$stageFrame));\r\n            calculateMinSize(e.data.$image);\r\n\r\n            if (e.data.$image.hasClass(imageZoommable) && !allowZoomOut || isImageSmall || isImageFit) {\r\n                resetVars(e.data.$image);\r\n            }\r\n\r\n            if (!isImageSmall) {\r\n                toggleStandartNavigation();\r\n            }\r\n        }\r\n\r\n        function getTopValue($image, topProp, step, height, containerHeight) {\r\n            var top;\r\n\r\n            if (parseInt($image.css('marginTop')) || parseInt($image.css('marginLeft'))) {\r\n                top = dragFlag ? topProp - step / 4 : 0;\r\n                top = top < containerHeight - height ? containerHeight - height : top;\r\n                top = top > height - containerHeight ? height - containerHeight : top;\r\n            } else {\r\n                top = topProp + step / 2;\r\n                top = top < containerHeight - height ? containerHeight - height : top;\r\n                top = top > 0 ? 0 : top;\r\n\r\n                if (!dragFlag && step < 0) {\r\n                    top = top < (containerHeight - height) / 2 ? (containerHeight - height) / 2 : top;\r\n                }\r\n            }\r\n\r\n            return top;\r\n        }\r\n\r\n        function getLeftValue(leftProp, step, width, containerWidth) {\r\n            var left;\r\n\r\n            left = leftProp + step / 2;\r\n            left = left < containerWidth - width ? containerWidth - width : left;\r\n            left = left > 0 ? 0 : left;\r\n\r\n            if (!dragFlag && step < 0) {\r\n                left = left < (containerWidth - width) / 2 ? (containerWidth - width) / 2 : left;\r\n            }\r\n\r\n            return left;\r\n        }\r\n\r\n        function checkFullscreenImagePosition($image, dimentions, widthStep, heightStep) {\r\n            var $imageContainer,\r\n                containerWidth,\r\n                containerHeight,\r\n                settings,\r\n                top,\r\n                left,\r\n                right,\r\n                bottom,\r\n                ratio;\r\n\r\n            if ($(gallerySelector).data('fotorama').fullScreen) {\r\n                transitionActive = true;\r\n                $imageContainer = $image.parent();\r\n                containerWidth = $imageContainer.width();\r\n                containerHeight = $imageContainer.height();\r\n                top = $image.position().top;\r\n                left = $image.position().left;\r\n                ratio = $image.width() / $image.height();\r\n                dimentions.height = isNaN(dimentions.height) ? dimentions.width / ratio : dimentions.height;\r\n                dimentions.width = isNaN(dimentions.width) ? dimentions.height * ratio : dimentions.width;\r\n\r\n                top = dimentions.height >= containerHeight ?\r\n                    getTopValue($image, top, heightStep, dimentions.height, containerHeight) : 0;\r\n\r\n                left = dimentions.width >= containerWidth ?\r\n                    getLeftValue(left, widthStep, dimentions.width, containerWidth) : 0;\r\n\r\n                right = dragFlag && left < (containerWidth - dimentions.width) / 2 ? 0 : left;\r\n                bottom = dragFlag ? 0 : top;\r\n\r\n                settings = $.extend(dimentions, {\r\n                    top: top,\r\n                    bottom: bottom,\r\n                    left: left,\r\n                    right: right\r\n                });\r\n\r\n                $image.css(settings);\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Toggles fotorama's keyboard and mouse/touch navigation.\r\n         */\r\n        function toggleStandartNavigation() {\r\n            var $selectable =\r\n                    $('a[href], area[href], input, select, textarea, button, iframe, object, embed, *[tabindex], *[contenteditable]')\r\n                    .not('[tabindex=-1], [disabled], :hidden'),\r\n                fotorama = $(gallerySelector).data('fotorama'),\r\n                $focus = $(':focus'),\r\n                index;\r\n\r\n            if (fotorama.fullScreen) {\r\n\r\n                $selectable.each(function (number) {\r\n\r\n                    if ($(this).is($focus)) {\r\n                        index = number;\r\n                    }\r\n                });\r\n\r\n                fotorama.setOptions({\r\n                    swipe: !allowZoomOut,\r\n                    keyboard: !allowZoomOut\r\n                });\r\n\r\n                if (_.isNumber(index)) {\r\n                    $selectable.eq(index).focus();\r\n                }\r\n            }\r\n        }\r\n\r\n        function zoomIn(e, xStep, yStep) {\r\n            var $image,\r\n                imgOriginalSize,\r\n                imageWidth,\r\n                imageHeight,\r\n                zoomWidthStep,\r\n                zoomHeightStep,\r\n                widthResult,\r\n                heightResult,\r\n                ratio,\r\n                dimentions = {};\r\n\r\n            if (allowZoomIn && (!transitionEnabled || !transitionActive) && (isTouchEnabled ||\r\n                !$(zoomInButtonSelector).hasClass(zoomInDisabled))) {\r\n                $image = $(fullscreenImageSelector);\r\n                imgOriginalSize = getImageSize($image[0].src);\r\n                imageWidth = $image.width();\r\n                imageHeight = $image.height();\r\n                ratio = imageWidth / imageHeight;\r\n                allowZoomOut = true;\r\n                toggleStandartNavigation();\r\n\r\n                if (!$image.hasClass(imageZoommable)) {\r\n                    toggleZoomable($image, true);\r\n                }\r\n\r\n                e.preventDefault();\r\n\r\n                if (imageWidth >= imageHeight) {\r\n                    zoomWidthStep = xStep || Math.ceil(imageWidth * parseFloat(config.magnifierOpts.fullscreenzoom) / 100);\r\n                    widthResult = imageWidth + zoomWidthStep;\r\n\r\n                    if (widthResult >= imgOriginalSize.rw) {\r\n                        widthResult = imgOriginalSize.rw;\r\n                        zoomWidthStep = xStep || widthResult - imageWidth;\r\n                        allowZoomIn = false;\r\n                    }\r\n                    heightResult = widthResult / ratio;\r\n                    zoomHeightStep = yStep || heightResult - imageHeight;\r\n                } else {\r\n                    zoomHeightStep = yStep || Math.ceil(imageHeight * parseFloat(config.magnifierOpts.fullscreenzoom) / 100);\r\n                    heightResult = imageHeight + zoomHeightStep;\r\n\r\n                    if (heightResult >= imgOriginalSize.rh) {\r\n                        heightResult = imgOriginalSize.rh;\r\n                        zoomHeightStep = yStep || heightResult - imageHeight;\r\n                        allowZoomIn = false;\r\n                    }\r\n                    widthResult = heightResult * ratio;\r\n                    zoomWidthStep = xStep || widthResult - imageWidth;\r\n                }\r\n\r\n                if (imageWidth >= imageHeight && imageWidth !== imgOriginalSize.rw) {\r\n                    dimentions = $.extend(dimentions, {\r\n                        width: widthResult,\r\n                        height: 'auto'\r\n                    });\r\n                    checkFullscreenImagePosition($image, dimentions, -zoomWidthStep, -zoomHeightStep);\r\n\r\n                } else if (imageWidth < imageHeight && imageHeight !== imgOriginalSize.rh) {\r\n                    dimentions = $.extend(dimentions, {\r\n                        width: 'auto',\r\n                        height: heightResult\r\n                    });\r\n                    checkFullscreenImagePosition($image, dimentions, -zoomWidthStep, -zoomHeightStep);\r\n                }\r\n            }\r\n\r\n            return false;\r\n        }\r\n\r\n        function zoomOut(e, xStep, yStep) {\r\n            var $image,\r\n                widthResult,\r\n                heightResult,\r\n                dimentions,\r\n                parentWidth,\r\n                parentHeight,\r\n                imageWidth,\r\n                imageHeight,\r\n                zoomWidthStep,\r\n                zoomHeightStep,\r\n                ratio,\r\n                fitIntoParent;\r\n\r\n            if (allowZoomOut && (!transitionEnabled || !transitionActive) && (isTouchEnabled ||\r\n                !$(zoomOutButtonSelector).hasClass(zoomOutDisabled))) {\r\n                allowZoomIn = true;\r\n                $image = $(fullscreenImageSelector);\r\n                parentWidth = $image.parent().width();\r\n                parentHeight = $image.parent().height();\r\n                imageWidth = $image.width();\r\n                imageHeight = $image.height();\r\n                ratio = imageWidth / imageHeight;\r\n\r\n                e.preventDefault();\r\n\r\n                if (imageWidth >= imageHeight) {\r\n                    zoomWidthStep = xStep || Math.ceil(imageWidth * parseFloat(config.magnifierOpts.fullscreenzoom) / 100);\r\n                    widthResult = imageWidth - zoomWidthStep;\r\n                    heightResult = widthResult / ratio;\r\n                    zoomHeightStep = yStep || imageHeight - heightResult;\r\n                } else {\r\n                    zoomHeightStep = yStep || Math.ceil(imageHeight * parseFloat(config.magnifierOpts.fullscreenzoom) / 100);\r\n                    heightResult = imageHeight - zoomHeightStep;\r\n                    widthResult = heightResult * ratio;\r\n                    zoomWidthStep = xStep || imageWidth - widthResult;\r\n                }\r\n\r\n                fitIntoParent = function () {\r\n                    if (ratio > parentWidth / parentHeight) {\r\n                        widthResult = parentWidth;\r\n                        zoomWidthStep = imageWidth - widthResult;\r\n                        heightResult = widthResult / ratio;\r\n                        zoomHeightStep = imageHeight - heightResult;\r\n                        dimentions = {\r\n                            width: widthResult,\r\n                            height: 'auto'\r\n                        };\r\n                    } else {\r\n                        heightResult = parentHeight;\r\n                        zoomHeightStep = imageHeight - heightResult;\r\n                        widthResult = heightResult * ratio;\r\n                        zoomWidthStep = imageWidth - widthResult;\r\n                        dimentions = {\r\n                            width: 'auto',\r\n                            height: heightResult\r\n                        };\r\n                    }\r\n                    checkFullscreenImagePosition($image, dimentions, zoomWidthStep, zoomHeightStep);\r\n                };\r\n\r\n                if (imageWidth >= imageHeight) {\r\n                    if (widthResult > parentWidth) {\r\n                        dimentions = {\r\n                            width: widthResult,\r\n                            height: 'auto'\r\n                        };\r\n                        checkFullscreenImagePosition($image, dimentions, zoomWidthStep, zoomHeightStep);\r\n                    } else {\r\n                        if (heightResult > parentHeight) {\r\n                            dimentions = {\r\n                                width: widthResult,\r\n                                height: 'auto'\r\n                            };\r\n                            checkFullscreenImagePosition($image, dimentions, zoomWidthStep, zoomHeightStep);\r\n                        } else {\r\n                            allowZoomOut = dragFlag = false;\r\n                            toggleStandartNavigation();\r\n                            fitIntoParent();\r\n                        }\r\n                    }\r\n                } else {\r\n                    if (heightResult > parentHeight) {\r\n                        dimentions = {\r\n                            width: 'auto',\r\n                            height: heightResult\r\n                        };\r\n                        checkFullscreenImagePosition($image, dimentions, zoomWidthStep, zoomHeightStep);\r\n                    } else {\r\n                        if (widthResult > parentWidth) {\r\n                            dimentions = {\r\n                                width: 'auto',\r\n                                height: heightResult\r\n                            };\r\n                            checkFullscreenImagePosition($image, dimentions, zoomWidthStep, zoomHeightStep);\r\n                        } else {\r\n                            allowZoomOut = dragFlag = false;\r\n                            toggleStandartNavigation();\r\n                            fitIntoParent();\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            return false;\r\n        }\r\n\r\n        /**\r\n         * Bind event on scroll on active item in fotorama\r\n         * @param e\r\n         * @param fotorama - object of fotorama\r\n         */\r\n        function mousewheel(e, fotorama, element) {\r\n            var $fotoramaStage = fotorama.activeFrame.$stageFrame,\r\n                fotoramaStage = $fotoramaStage.get(0);\r\n\r\n            function onWheel(e) {\r\n                var delta = e.deltaY || e.wheelDelta,\r\n                    ev = e || window.event;\r\n\r\n                if ($(gallerySelector).data('fotorama').fullScreen) {\r\n\r\n                    if (e.deltaY) {\r\n                        if (delta > 0) {\r\n                            zoomOut(ev);\r\n                        } else {\r\n                            zoomIn(ev);\r\n                        }\r\n                    } else {\r\n                        if (delta > 0) {\r\n                            zoomIn(ev);\r\n                        } else {\r\n                            zoomOut(ev);\r\n                        }\r\n                    }\r\n\r\n                    e.preventDefault ? e.preventDefault() : e.returnValue = false;\r\n                }\r\n            }\r\n\r\n            if (!$fotoramaStage.hasClass('magnify-wheel-loaded')) {\r\n                if (fotoramaStage && fotoramaStage.addEventListener) {\r\n                    if ('onwheel' in document) {\r\n                        fotoramaStage.addEventListener('wheel', onWheel);\r\n                    } else if ('onmousewheel' in document) {\r\n                        fotoramaStage.addEventListener('mousewheel', onWheel);\r\n                    } else {\r\n                        fotoramaStage.addEventListener('MozMousePixelScroll', onWheel);\r\n                    }\r\n                    $fotoramaStage.addClass('magnify-wheel-loaded');\r\n                }\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Method which makes draggable picture. Also work on touch devices.\r\n         */\r\n        function magnifierFullscreen(fotorama) {\r\n            var isDragActive = false,\r\n                startX,\r\n                startY,\r\n                imagePosX,\r\n                imagePosY,\r\n                touch,\r\n                swipeSlide,\r\n                $gallery = $(gallerySelector),\r\n                $image = $(fullscreenImageSelector, $gallery),\r\n                $imageContainer = $('[data-gallery-role=\"stage-shaft\"] [data-active=\"true\"]'),\r\n                gallery = $gallery.data('fotorama'),\r\n                pinchDimention;\r\n\r\n            swipeSlide = _.throttle(function (direction) {\r\n                $(gallerySelector).data('fotorama').show(direction);\r\n            }, 500, {\r\n                trailing: false\r\n            });\r\n\r\n            function shiftImage(dx, dy, e) {\r\n                var top = +imagePosY + dy,\r\n                    left = +imagePosX + dx,\r\n                    swipeCondition = $image.width() / 10 + 20;\r\n\r\n                dragFlag = true;\r\n\r\n                if (($image.offset().left === $imageContainer.offset().left + $imageContainer.width() - $image.width() && e.keyCode === 39) ||\r\n                    (endX - 1 < $imageContainer.offset().left + $imageContainer.width() - $image.width() && dx < 0 && \r\n                    _.isNumber(endX) &&\r\n                    (e.type === 'mousemove' || e.type === 'touchmove' || e.type === 'pointermove' || e.type === 'MSPointerMove'))) {\r\n                    endX = null;\r\n                    swipeSlide('>');\r\n                    return;\r\n                }\r\n\r\n                if (($image.offset().left === $imageContainer.offset().left && dx !== 0 && e.keyCode === 37) ||\r\n                    (endX === $imageContainer.offset().left && dx > 0 &&\r\n                    (e.type === 'mousemove' || e.type === 'touchmove' || e.type === 'pointermove' || e.type === 'MSPointerMove'))) {\r\n                    endX = null;\r\n                    swipeSlide('<');\r\n\r\n                    return;\r\n                }\r\n\r\n                if ($image.height() > $imageContainer.height()) {\r\n\r\n                    if ($imageContainer.offset().top + $imageContainer.height() > top + $image.height()) {\r\n                        top = $imageContainer.offset().top + $imageContainer.height() - $image.height();\r\n                    } else {\r\n                        top = $imageContainer.offset().top < top ? 0 : top;\r\n                    }\r\n                    $image.offset({\r\n                        'top': top\r\n                    });\r\n                    $image.css('bottom', '');\r\n                }\r\n\r\n                if ($image.width() > $imageContainer.width()) {\r\n\r\n                    if ($imageContainer.offset().left + $imageContainer.width() > left + $image.width()) {\r\n                        left = $imageContainer.offset().left + $imageContainer.width() - $image.width();\r\n                    } else {\r\n                        left = $imageContainer.offset().left < left ? $imageContainer.offset().left : left;\r\n                    }\r\n                    $image.offset({\r\n                        'left': left\r\n                    });\r\n                    $image.css('right', '');\r\n                } else if (Math.abs(dy) < 1 && allowZoomOut &&\r\n                    !(e.type === 'mousemove' || e.type === 'touchmove' || e.type === 'pointermove' || e.type === 'MSPointerMove')) {\r\n                    dx < 0 ? $(gallerySelector).data('fotorama').show('>') : $(gallerySelector).data('fotorama').show('<');\r\n                }\r\n\r\n                if ($image.width() <= $imageContainer.width() && allowZoomOut &&\r\n                    (e.type === 'mousemove' || e.type === 'touchmove' || e.type === 'pointermove' || e.type === 'MSPointerMove') && \r\n                    Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > swipeCondition) {\r\n                    dx < 0 ? swipeSlide('>') : swipeSlide('<');\r\n                }\r\n            }\r\n\r\n            /**\r\n             * Sets image size to original or fit in parent block\r\n             * @param e - event object\r\n             */\r\n            function dblClickHandler(e) {\r\n                var imgOriginalSize = getImageSize($image[0].src),\r\n                    proportions;\r\n\r\n                if (imgOriginalSize.rh < $image.parent().height() && imgOriginalSize.rw < $image.parent().width()) {\r\n                    return;\r\n                }\r\n\r\n                proportions = imgOriginalSize.rw / imgOriginalSize.rh;\r\n\r\n                if (allowZoomIn) {\r\n                    zoomIn(e, imgOriginalSize.rw - $image.width(), imgOriginalSize.rh - $image.height());\r\n                } else {\r\n                    if (proportions > $imageContainer.width() / $imageContainer.height()) {\r\n                        zoomOut(e, imgOriginalSize.rw - $imageContainer.width(), imgOriginalSize.rw / proportions);\r\n                    } else {\r\n                        zoomOut(e, imgOriginalSize.rw * proportions, imgOriginalSize.rh - $imageContainer.height());\r\n                    }\r\n                }\r\n            }\r\n\r\n            function detectDoubleTap(e) {\r\n                var now = new Date().getTime(),\r\n                    timesince = now - tapFlag;\r\n\r\n                if (timesince < 400 && timesince > 0) {\r\n                    transitionActive = false;\r\n                    tapFlag = 0;\r\n                    dblClickHandler(e);\r\n                } else {\r\n                    tapFlag = new Date().getTime();\r\n                }\r\n            }\r\n\r\n            if (isTouchEnabled) {\r\n                $image.off('tap');\r\n                $image.on('tap', function (e) {\r\n                    if (e.originalEvent.originalEvent.touches.length === 0) {\r\n                        detectDoubleTap(e);\r\n                    }\r\n                });\r\n            } else {\r\n                $image.unbind('dblclick');\r\n                $image.dblclick(dblClickHandler);\r\n            }\r\n\r\n            if (gallery.fullScreen) {\r\n                toggleZoomButtons($image, isTouchEnabled, checkForVideo(fotorama.activeFrame.$stageFrame));\r\n            }\r\n\r\n            function getDimention(event) {\r\n                return Math.sqrt(\r\n                    (event.touches[0].clientX - event.touches[1].clientX) * (event.touches[0].clientX - event.touches[1].clientX) +\r\n                    (event.touches[0].clientY - event.touches[1].clientY) * (event.touches[0].clientY - event.touches[1].clientY));\r\n            }\r\n\r\n            $image.off(isTouchEnabled ? 'touchstart' : 'pointerdown mousedown MSPointerDown');\r\n            $image.on(isTouchEnabled ? 'touchstart' : 'pointerdown mousedown MSPointerDown', function (e) {\r\n                if (e && e.originalEvent.touches && e.originalEvent.touches.length >= 2) {\r\n                    e.preventDefault();\r\n                    pinchDimention = getDimention(e.originalEvent);\r\n                    isDragActive = false;\r\n\r\n                    if ($image.hasClass(imageDraggableClass)) {\r\n                        $image.removeClass(imageDraggableClass);\r\n                    }\r\n                } else {\r\n                    if (gallery.fullScreen && (!transitionEnabled || !transitionActive)) {\r\n                        e.preventDefault();\r\n\r\n                        imagePosY = $image.offset().top;\r\n                        imagePosX = $image.offset().left;\r\n\r\n                        if (isTouchEnabled) {\r\n                            touch = e.originalEvent.touches[0] || e.originalEvent.changedTouches[0];\r\n                            e.clientX = touch.pageX;\r\n                            e.clientY = touch.pageY;\r\n                        }\r\n                        startX = e.clientX || e.originalEvent.clientX;\r\n                        startY = e.clientY || e.originalEvent.clientY;\r\n                        isDragActive = true;\r\n                    }\r\n                }\r\n\r\n                if ($image.offset() && ($image.width() > $imageContainer.width())) {\r\n                    endX = $image.offset().left;\r\n                }\r\n            });\r\n\r\n            $image.off(isTouchEnabled ? 'touchmove' : 'mousemove pointermove MSPointerMove');\r\n            $image.on(isTouchEnabled ? 'touchmove' : 'mousemove pointermove MSPointerMove', function (e) {\r\n                if (e && e.originalEvent.touches && e.originalEvent.touches.length >= 2) {\r\n                    e.preventDefault();\r\n                    var currentDimention = getDimention(e.originalEvent);\r\n\r\n                    if ($image.hasClass(imageDraggableClass)) {\r\n                        $image.removeClass(imageDraggableClass);\r\n                    }\r\n                    if (currentDimention < pinchDimention) {\r\n                        zoomOut(e);\r\n                        pinchDimention = currentDimention;\r\n                    } else if (currentDimention > pinchDimention) {\r\n                        zoomIn(e);\r\n                        pinchDimention = currentDimention;\r\n                    }\r\n                } else {\r\n                    var clientX,\r\n                        clientY;\r\n\r\n                    if (gallery.fullScreen && isDragActive && (!transitionEnabled || !transitionActive)) {\r\n\r\n                        if (allowZoomOut && !$image.hasClass(imageDraggableClass)) {\r\n                            $image.addClass(imageDraggableClass);\r\n                        }\r\n                        clientX = e.clientX || e.originalEvent.clientX;\r\n                        clientY = e.clientY || e.originalEvent.clientY;\r\n\r\n                        e.preventDefault();\r\n\r\n                        if (isTouchEnabled) {\r\n                            touch = e.originalEvent.touches[0] || e.originalEvent.changedTouches[0];\r\n                            clientX = touch.pageX;\r\n                            clientY = touch.pageY;\r\n                        }\r\n\r\n                        if (allowZoomOut) {\r\n                            shiftImage(clientX - startX, clientY - startY, e);\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n\r\n            $image.off('transitionend webkitTransitionEnd mozTransitionEnd msTransitionEnd ');\r\n            $image.on('transitionend webkitTransitionEnd mozTransitionEnd msTransitionEnd', function () {\r\n                transitionActive = false;\r\n            });\r\n\r\n            if (keyboardNavigation) {\r\n                $(document).unbind('keydown', keyboardNavigation);\r\n            }\r\n\r\n            /**\r\n             * Replaces original navigations with better one\r\n             * @param e - event object\r\n             */\r\n            keyboardNavigation = function (e) {\r\n                var step = 40,\r\n                    $focus = $(':focus'),\r\n                    isFullScreen = $(gallerySelector).data('fotorama').fullScreen,\r\n                    initVars = function () {\r\n                        imagePosX = $(fullscreenImageSelector, $gallery).offset().left;\r\n                        imagePosY = $(fullscreenImageSelector, $gallery).offset().top;\r\n                    };\r\n\r\n                if (($focus.attr('data-gallery-role') || !$focus.length) && allowZoomOut) {\r\n                    if (isFullScreen) {\r\n                        imagePosX = $(fullscreenImageSelector, $(gallerySelector)).offset().left;\r\n                        imagePosY = $(fullscreenImageSelector, $(gallerySelector)).offset().top;\r\n                    }\r\n\r\n                    if (e.keyCode === 39) {\r\n\r\n                        if (isFullScreen) {\r\n                            initVars();\r\n                            shiftImage(-step, 0, e);\r\n                        }\r\n                    }\r\n\r\n                    if (e.keyCode === 38) {\r\n\r\n                        if (isFullScreen) {\r\n                            initVars();\r\n                            shiftImage(0, step, e);\r\n                        }\r\n                    }\r\n\r\n                    if (e.keyCode === 37) {\r\n\r\n                        if (isFullScreen) {\r\n                            initVars();\r\n                            shiftImage(step, 0, e);\r\n                        }\r\n                    }\r\n\r\n                    if (e.keyCode === 40) {\r\n\r\n                        if (isFullScreen) {\r\n                            e.preventDefault();\r\n                            initVars();\r\n                            shiftImage(0, -step, e);\r\n                        }\r\n                    }\r\n                }\r\n\r\n                if (e.keyCode === 27 && isFullScreen && allowZoomOut) {\r\n                    $(gallerySelector).data('fotorama').cancelFullScreen();\r\n                }\r\n            };\r\n\r\n            /**\r\n             * @todo keyboard navigation through Fotorama Api.\r\n             */\r\n            $(document).keydown(keyboardNavigation);\r\n\r\n            $(document).on(isTouchEnabled ? 'touchend' : 'mouseup pointerup MSPointerUp', function (e) {\r\n                if (gallery.fullScreen) {\r\n\r\n                    if ($image.offset() && $image.width() > $imageContainer.width()) {\r\n                        endX = $image.offset().left;\r\n                    }\r\n\r\n                    isDragActive = false;\r\n                    $image.removeClass(imageDraggableClass);\r\n                }\r\n            });\r\n\r\n            $(window).off('resize', resizeHandler);\r\n            $(window).on('resize', {\r\n                $image: $image,\r\n                fotorama: fotorama\r\n            }, resizeHandler);\r\n        }\r\n\r\n        /**\r\n         * Hides magnifier preview and zoom blocks.\r\n         */\r\n        hideMagnifier = function () {\r\n            $(magnifierSelector).empty().hide();\r\n            $(magnifierZoomSelector).remove();\r\n        };\r\n\r\n        /**\r\n         * Check is active frame in gallery include video content.\r\n         * If true activeFrame contain video.\r\n         * @param $stageFrame - active frame in gallery\r\n         * @returns {*|Boolean}\r\n         */\r\n        function checkForVideo($stageFrame) {\r\n            return $stageFrame.hasClass(videoContainerClass);\r\n        }\r\n\r\n        /**\r\n         * Hides magnifier on drag and while arrow click.\r\n         */\r\n        function behaveOnDrag(e, initPos) {\r\n            var pos = [e.pageX, e.pageY],\r\n                isArrow = $(e.target).data('gallery-role') === 'arrow',\r\n                isClick = initPos[0] === pos[0] && initPos[1] === pos[1],\r\n                isImg = $(e.target).parent().data('active');\r\n\r\n            if (isArrow || isImg && !isClick) {\r\n                hideMagnifier();\r\n            }\r\n        }\r\n\r\n        if (config.magnifierOpts.enabled) {\r\n            $(element).on('pointerdown mousedown MSPointerDown', function (e) {\r\n                var pos = [e.pageX, e.pageY];\r\n\r\n                $(element).on('mousemove pointermove MSPointerMove', function (ev) {\r\n                    navigator.msPointerEnabled ? hideMagnifier() : behaveOnDrag(ev, pos);\r\n                });\r\n                $(document).on('mouseup pointerup MSPointerUp', function () {\r\n                    $(element).off('mousemove pointermove MSPointerMove');\r\n                });\r\n            });\r\n        }\r\n\r\n        $.extend(config.magnifierOpts, {\r\n            zoomable: false,\r\n            thumb: '.fotorama__img',\r\n            largeWrapper: '[data-gallery-role=\"magnifier\"]',\r\n            height: config.magnifierOpts.height || function () {\r\n                return $('[data-active=\"true\"]').height();\r\n            },\r\n            width: config.magnifierOpts.width || function () {\r\n                var productMedia = $(gallerySelector).parent().parent();\r\n\r\n                return productMedia.parent().width() - productMedia.width() - 20;\r\n            },\r\n            left: config.magnifierOpts.left || function () {\r\n                return $(gallerySelector).offset().left + $(gallerySelector).width() + 20;\r\n            },\r\n            top: config.magnifierOpts.top || function () {\r\n                return $(gallerySelector).offset().top;\r\n            }\r\n        });\r\n\r\n        $(element).on('fotorama:load fotorama:showend fotorama:fullscreenexit fotorama:ready', function (e, fotorama) {\r\n            var $activeStageFrame = $(gallerySelector).data('fotorama').activeFrame.$stageFrame;\r\n\r\n            if (!$activeStageFrame.find(magnifierZoomSelector).length) {\r\n                hideMagnifier();\r\n\r\n                if (config.magnifierOpts) {\r\n                    config.magnifierOpts.large = $(gallerySelector).data('fotorama').activeFrame.img;\r\n                    config.magnifierOpts.full = fotorama.data[fotorama.activeIndex].original;\r\n                    !checkForVideo($activeStageFrame) && $($activeStageFrame).magnify(config.magnifierOpts);\r\n                }\r\n            }\r\n        });\r\n\r\n        $(element).on('gallery:loaded', function (e) {\r\n            var $prevImage;\r\n\r\n            $(element).find(gallerySelector)\r\n                .on('fotorama:ready', function (e, fotorama) {\r\n                    var $zoomIn = $(zoomInButtonSelector),\r\n                        $zoomOut = $(zoomOutButtonSelector);\r\n\r\n                    if (!$zoomIn.hasClass(zoomInLoaded)) {\r\n                        $zoomIn.on('click touchstart', zoomIn);\r\n                        $zoomIn.on('mousedown', function(e) {\r\n                            e.stopPropagation();\r\n                        });\r\n\r\n                        $zoomIn.keyup(function (e) {\r\n\r\n                            if (e.keyCode === 13) {\r\n                                zoomIn(e);\r\n                            }\r\n                        });\r\n\r\n                        $(window).keyup(function (e) {\r\n\r\n                            if (e.keyCode === 107 || fotorama.fullscreen) {\r\n                                zoomIn(e);\r\n                            }\r\n                        });\r\n\r\n                        $zoomIn.addClass(zoomInLoaded);\r\n                    }\r\n\r\n                    if (!$zoomOut.hasClass(zoomOutLoaded)) {\r\n                        $zoomOut.on('click touchstart', zoomOut);\r\n                        $zoomOut.on('mousedown', function(e) {\r\n                            e.stopPropagation();\r\n                        });\r\n\r\n                        $zoomOut.keyup(function (e) {\r\n\r\n                            if (e.keyCode === 13) {\r\n                                zoomOut(e);\r\n                            }\r\n                        });\r\n\r\n                        $(window).keyup(function (e) {\r\n\r\n                            if (e.keyCode === 109 || fotorama.fullscreen) {\r\n                                zoomOut(e);\r\n                            }\r\n                        });\r\n\r\n                        $zoomOut.addClass(zoomOutLoaded);\r\n                    }\r\n                })\r\n                .on('fotorama:fullscreenenter fotorama:showend', function (e, fotorama) {\r\n                    hideMagnifier();\r\n\r\n                    if (!$(fullscreenImageSelector).is($prevImage)) {\r\n                        resetVars($(fullscreenImageSelector));\r\n                    }\r\n                    magnifierFullscreen(fotorama);\r\n                    mousewheel(e, fotorama, element);\r\n\r\n                    if ($prevImage) {\r\n                        calculateMinSize($prevImage);\r\n\r\n                        if (!$(fullscreenImageSelector).is($prevImage)) {\r\n                            resetVars($prevImage);\r\n                        }\r\n                    }\r\n\r\n                    toggleStandartNavigation();\r\n                })\r\n                .on('fotorama:load', function (e, fotorama) {\r\n                    if ($(gallerySelector).data('fotorama').fullScreen) {\r\n                        toggleZoomButtons($(fullscreenImageSelector), isTouchEnabled,\r\n                            checkForVideo(fotorama.activeFrame.$stageFrame));\r\n                    }\r\n                    magnifierFullscreen(fotorama);\r\n                })\r\n                .on('fotorama:show', function (e, fotorama) {\r\n                    $prevImage = _.clone($(fullscreenImageSelector));\r\n                    hideMagnifier();\r\n                })\r\n                .on('fotorama:fullscreenexit', function (e, fotorama) {\r\n                    resetVars($(fullscreenImageSelector));\r\n                    hideMagnifier();\r\n                    hideZoomControls(true);\r\n                });\r\n        });\r\n\r\n        return config;\r\n    };\r\n});\r\n"}
    }
});
